@page "/series/{SeriesId}"
@inherits Pages.Series.IndexBase

<MudContainer Class="px-8" MaxWidth="MaxWidth.False">

    <MudBreadcrumbs Items="Breadcrumbs"></MudBreadcrumbs>

    @if (Item == null)
    {
        <Loading />
    }
    else
    {
        <MudPaper Elevation="3">
            <div class="series-header">
                <img src="@Item.Series.ImageUrl" width="200" />
                <div class="series-header-content">

                    <div class="series-info">
                        <MudText Typo="Typo.h5">@Item.Series.Title</MudText>
                        <MudText Typo="Typo.subtitle2">@Item.Series.Publisher</MudText>
                        <MudText Typo="Typo.subtitle2">@Item.Series.Years</MudText>
                        @*<MudText Typo="Typo.body1">Progress: @(Item.Series.Progress)</MudText>*@
                    </div>

                    <div class="series-actions">
                        <MudButtonGroup Color="@Item.Series.MudColor()" Variant="Variant.Outlined">
                            @foreach (var action in Actions)
                            {
                                <MudIconButton OnClick="() => OnAction(action)" Icon="@action.Icon" Color="@Item.Series.MudColor()"></MudIconButton>
                            }
                        </MudButtonGroup>
                    </div>

                </div>
                <div class="series-icon">
                    <MudAvatar Color="@Item.Series.MudColor()">@Item.Series.PublisherIcon</MudAvatar>
                </div>
            </div>
        </MudPaper>

        <MudExpansionPanels MultiExpansion="true">
            @foreach (var booklist in Item.BookLists.Where(bl => bl.Home))
            {
                <MudExpansionPanel Text="@booklist.TypeName" MaxHeight="1000">

                    <MudGrid>

                        @foreach (var item in booklist.Books)
                        {
                            <MudItem xs="12" sm="4" md="3" lg="2">
                                <LibraryBookCard Book="@item" @key="item" />
                            </MudItem>
                        }
                    </MudGrid>

                </MudExpansionPanel>
            }
        </MudExpansionPanels>

        @if (Item.BookLists.Any(bl => !bl.Home && bl.TypeId > 0))
        {
            <MudText Typo="Typo.h5">Additional Types</MudText>

            <MudExpansionPanels>
                @foreach (var booklist in Item.BookLists.Where(bl => !bl.Home && bl.TypeId > 0))
                {
                    <MudExpansionPanel Text="@booklist.TypeName" MaxHeight="1000">
                        @foreach (var book in booklist.Books)
                        {
                            <MudText>@book.IssueTitle</MudText>
                        }
                    </MudExpansionPanel>
                }
            </MudExpansionPanels>
        }

        @if (Item.BookLists.Any(bl => !bl.Home && bl.TypeId < 0))
        {
            <MudText Typo="Typo.h5">Removed Books</MudText>

            <MudExpansionPanels>
                @foreach (var booklist in Item.BookLists.Where(bl => !bl.Home && bl.TypeId < 0))
                {
                    <MudExpansionPanel Text="Removed Books" MaxHeight="1000">
                        @foreach (var book in booklist.Books)
                        {
                            <MudText>@book.IssueTitle</MudText>
                        }
                    </MudExpansionPanel>
                }
            </MudExpansionPanels>

        }
    }

</MudContainer>