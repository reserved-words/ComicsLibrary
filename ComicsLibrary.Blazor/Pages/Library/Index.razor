@page "/library"


<MudContainer Class="mt-8 px-8" MaxWidth="MaxWidth.False">
    <MudText Typo="Typo.h3">Library</MudText>
    <MudToolBar>
        <MudTextField @bind-Value="searchString" Placeholder="Search" Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Class="mt-0"></MudTextField>
        <MudToolBarSpacer />
        <MudFab Color="Color.Primary" Icon="@Icons.Material.Filled.GridView" Size="Size.Small" IconSize="Size.Small" Label="Grid View" Class="ma-2" Disabled="@gridView" OnClick="@EnableGridView" />
        <MudFab Color="Color.Primary" Icon="@Icons.Material.Filled.TableView" Size="Size.Small" IconSize="Size.Small" Label="Table View" Class="ma-2" Disabled="@tableView" OnClick="@EnableTableView" />
    </MudToolBar>

    <MudGrid Class="@(gridView ? "" : "d-none")">
        @foreach (var comic in Comics)
        {
            <MudItem xs="6" sm="3">
                <MudCard>
                    <MudCardHeader>
                        <CardHeaderAvatar>
                            <MudAvatar Color="@comic.Color">@comic.PublisherIcon</MudAvatar>
                        </CardHeaderAvatar>
                        <CardHeaderContent>
                            <MudText Typo="Typo.body1">@comic.Name</MudText>
                            <MudText Typo="Typo.body2">@comic.Years</MudText>
                        </CardHeaderContent>
                        <CardHeaderActions>
                            <MudIconButton Icon="@Icons.Material.Filled.Settings" Color="Color.Default" />
                        </CardHeaderActions>
                    </MudCardHeader>
                    <MudProgressLinear Color="comic.Color" Value="@comic.Progress" />
                    <MudCardMedia Image="@comic.ImageUrl" Height="250" />
                    <MudCardActions>
                        <MudIconButton Icon="@Icons.Material.Filled.LibraryBooks" Color="Color.Default" />
                        <MudIconButton Icon="@Icons.Material.Filled.Archive" Color="Color.Default" />
                        <MudIconButton Icon="@Icons.Material.Filled.Delete" Color="Color.Default" />
                    </MudCardActions>
                </MudCard>
            </MudItem>
        }
    </MudGrid>


    <MudTable Class="@(tableView ? "" : "d-none")" Items="@Comics" Dense="true" Hover="true" Filter="new Func<Comic,bool>(FilterFunc)" @bind-SelectedItem="selectedItem">
        @*<ToolBarContent>
            <MudText Typo="Typo.h6">Series</MudText>
            <MudToolBarSpacer />
            <MudTextField @bind-Value="searchString" Placeholder="Search" Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Class="mt-0"></MudTextField>
        </ToolBarContent>*@
        <HeaderContent>
            <MudTh>Id</MudTh>
            <MudTh>Name</MudTh>
            <MudTh>Publisher</MudTh>
        </HeaderContent>
        <RowTemplate>
            <MudTd DataLabel="Id">@context.Id</MudTd>
            <MudTd DataLabel="Name">@context.Name</MudTd>
            <MudTd DataLabel="Publisher">@context.Publisher</MudTd>
        </RowTemplate>
        <PagerContent>
            <MudTablePager />
        </PagerContent>
    </MudTable>


</MudContainer>


@code {
    private string searchString = "";
    private Comic selectedItem = null;
    private HashSet<Comic> selectedItems = new HashSet<Comic>();
    private bool tableView = false;
    private bool gridView = true;

    private IEnumerable<Comic> Comics = new List<Comic>();

    protected override async Task OnInitializedAsync()
    {
        Comics = new List<Comic>
        {
            new Comic{ Id = 1, Publisher = "DC", Name = "Batman", Number = 1, PublisherIcon = "DC", Years = "2019-", Color = Color.Info, Progress = 50, ImageUrl = "https://images-na.ssl-images-amazon.com/images/I/51Ibe1bTtdL._SX313_BO1,204,203,200_.jpg"  },
            new Comic{ Id = 2, Publisher = "DC", Name = "Superman", Number = 2, PublisherIcon = "DC", Years = "2015-2017", Color = Color.Info, Progress = 65, ImageUrl = "https://images-na.ssl-images-amazon.com/images/I/519RbENDlTL._SX329_BO1,204,203,200_.jpg"  },
            new Comic{ Id = 3, Publisher = "Marvel", Name = "Iron Man", Number = 1, PublisherIcon = "M", Years = "2021-", Color = Color.Error, Progress = 20, ImageUrl = "https://i.pinimg.com/originals/3d/7e/ac/3d7eac416e5ced11f04fb7e96ddfe3a8.jpg"  },
            new Comic{ Id = 4, Publisher = "Marvel", Name = "Captain Marvel", Number = 2 , PublisherIcon = "M", Years = "2004-2006", Color = Color.Error, Progress = 87, ImageUrl = "https://s3.amazonaws.com/comicgeeks/comics/covers/large-9754559.jpg" },
            new Comic{ Id = 5, Publisher = "Image Comics", Name = "Sex Criminals", Number = 1, PublisherIcon = "I", Color = Color.Primary, Progress = 15, ImageUrl = "https://images-na.ssl-images-amazon.com/images/I/71dyjDZWEML.jpg"  },
            new Comic{ Id = 5, Publisher = "Boom Studios", Name = "Lumberjanes", Number = 1, PublisherIcon = "B", Color = Color.Secondary, Progress = 76, ImageUrl = "https://images-na.ssl-images-amazon.com/images/I/81U4rjx0Z0L.jpg"  }
        };
    }

    private bool FilterFunc(Comic element)
    {
        if (string.IsNullOrWhiteSpace(searchString))
            return true;
        if (element.Publisher.Contains(searchString, StringComparison.OrdinalIgnoreCase))
            return true;
        if (element.Name.Contains(searchString, StringComparison.OrdinalIgnoreCase))
            return true;
        if ($"{element.Number}".Contains(searchString))
            return true;
        return false;
    }

    public class Comic
    {
        public int Id { get; set; }
        public string Name { get; set; }
        public int Number { get; set; }
        public string Publisher { get; set; }
        public string PublisherIcon { get; set; }
        public string Years { get; set; }
        public Color Color { get; set; }
        public string ImageUrl { get; set; }
        public int Progress { get; set; }
    }

    private void EnableTableView()
    {
        tableView = true;
        gridView = false;
    }

    private void EnableGridView()
    {
        tableView = false;
        gridView = true;
    }
}